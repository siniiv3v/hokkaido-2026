<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hokkaido Trip Premium</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Noto+Sans+TC:wght@300;400;500&display=swap');
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: #F2F2F2; color: #333; overflow-x: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .fab { position: fixed; bottom: 30px; right: 20px; width: 56px; height: 56px; border-radius: 50%; background: #333; color: white; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 40; }
        .tab-active { color: #000; border-bottom: 2px solid #000; font-weight: 500; }
        .premium-shadow { box-shadow: 0 2px 15px rgba(0,0,0,0.03); }
        .date-card-active { background: #333 !important; color: white !important; }
        .modal-overlay { background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); }
        /* Êó•Á≥ªÁ∞°Á¥ÑËº∏ÂÖ•Ê°Ü */
        input, select, textarea { border: 1px solid #E5E5E5; border-radius: 8px; padding: 10px; font-size: 14px; background: #FAFAFA; width: 100%; outline: none; }
        input:focus { border-color: #333; }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen relative bg-[#F2F2F2] pb-20">
    
    <nav class="sticky top-0 z-50 bg-[#F2F2F2]/90 backdrop-blur-md">
        <div class="flex justify-around items-center py-4 border-b border-gray-200">
            <button @click="activeTab = 'info'" :class="{'tab-active': activeTab === 'info'}" class="pb-2 transition-all opacity-80 hover:opacity-100">
                <i class="fa-solid fa-circle-info text-xl"></i>
            </button>
            <button @click="activeTab = 'schedule'" :class="{'tab-active': activeTab === 'schedule'}" class="pb-2 transition-all opacity-80 hover:opacity-100">
                <i class="fa-solid fa-calendar-days text-xl"></i>
            </button>
            <button @click="activeTab = 'shopping'" :class="{'tab-active': activeTab === 'shopping'}" class="pb-2 transition-all opacity-80 hover:opacity-100">
                <i class="fa-solid fa-cart-shopping text-xl"></i>
            </button>
            <button @click="activeTab = 'spending'" :class="{'tab-active': activeTab === 'spending'}" class="pb-2 transition-all opacity-80 hover:opacity-100">
                <i class="fa-solid fa-wallet text-xl"></i>
            </button>
        </div>

        <div v-if="activeTab === 'schedule'" class="flex overflow-x-auto no-scrollbar py-4 px-4 space-x-3 bg-white/50">
            <div v-for="(day, index) in days" :key="index" 
                 @click="currentDayIndex = index"
                 :class="{'date-card-active': currentDayIndex === index}"
                 class="flex-shrink-0 w-16 h-20 bg-white rounded-xl flex flex-col items-center justify-center premium-shadow transition-all border border-gray-100">
                <span class="text-xs uppercase opacity-60">{{ day.week }}</span>
                <span class="text-xl font-bold leading-none my-1">{{ day.dayNum }}</span>
                <span class="text-[10px] opacity-60">{{ day.date }}</span>
            </div>
        </div>
    </nav>

    <main class="p-5">
        
        <section v-if="activeTab === 'info'" class="space-y-6">
            <div class="bg-white p-5 rounded-2xl premium-shadow">
                <h3 class="text-xs font-bold tracking-widest text-gray-400 mb-4 uppercase">Currency Converter</h3>
                <div class="flex items-center space-x-4">
                    <div class="flex-1">
                        <label class="text-[10px] text-gray-400">JPY (Êó•Âπ£)</label>
                        <input type="number" v-model="calcJPY" class="mt-1">
                    </div>
                    <i class="fa-solid fa-arrow-right-long mt-4 text-gray-300"></i>
                    <div class="flex-1">
                        <label class="text-[10px] text-gray-400">HKD (Ê∏ØÂπ£)</label>
                        <div class="mt-1 p-2 text-lg font-medium">‚âà {{ (calcJPY * exchangeRate).toFixed(2) }}</div>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <div v-for="flight in flights" class="bg-white p-6 rounded-3xl premium-shadow relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-gray-100 px-4 py-1 text-[10px] rounded-bl-xl">{{ flight.type }}</div>
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-center">
                            <h4 class="text-2xl font-bold">{{ flight.from }}</h4>
                            <p class="text-[10px] text-gray-400">{{ flight.depTime }}</p>
                        </div>
                        <div class="flex-1 px-4 flex flex-col items-center">
                            <span class="text-[10px] text-gray-300 font-mono">{{ flight.duration }}</span>
                            <div class="w-full h-[1px] bg-gray-200 relative my-2">
                                <i class="fa-solid fa-plane absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-gray-300 text-[10px]"></i>
                            </div>
                            <span class="text-[10px] text-gray-500">{{ flight.no }}</span>
                        </div>
                        <div class="text-center">
                            <h4 class="text-2xl font-bold">{{ flight.to }}</h4>
                            <p class="text-[10px] text-gray-400">{{ flight.arrTime }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-4">
                <div v-for="h in hotels" class="bg-white p-5 rounded-2xl premium-shadow border-l-4 border-gray-800">
                    <h4 class="font-bold text-sm">{{ h.name }}</h4>
                    <p class="text-xs text-gray-500 mt-1"><i class="fa-solid fa-phone mr-1"></i> {{ h.tel }}</p>
                    <button @click="openMap(h.address)" class="mt-3 text-[10px] underline tracking-widest">NAVIGATE</button>
                </div>
            </div>
        </section>

        <section v-if="activeTab === 'schedule'" class="space-y-4">
            <div v-for="(item, idx) in currentDayItinerary" :key="item.id">
                <div v-if="idx >= 0" class="flex items-center py-2 px-6 space-x-4 opacity-40">
                    <div class="w-px h-6 bg-dashed border-l border-gray-400"></div>
                    <div class="flex items-center text-[10px] space-x-2">
                        <i :class="getTransportIcon(item.transport)"></i>
                        <span>Á¥Ñ {{ item.travelTime || '15' }} min</span>
                    </div>
                </div>

                <div @click="editItem('schedule', item, idx)" class="bg-white p-5 rounded-2xl premium-shadow relative group">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-[10px] px-2 py-0.5 bg-gray-100 rounded text-gray-500 mr-2">{{ item.category }}</span>
                            <h4 class="text-lg font-medium mt-1">{{ item.name }}</h4>
                        </div>
                        <button @click.stop="openMap(item.name)" class="text-gray-400 hover:text-black">
                            <i class="fa-solid fa-location-arrow"></i>
                        </button>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-[11px] text-gray-500">
                        <div v-if="item.hours"><i class="fa-regular fa-clock mr-1"></i> {{ item.hours }}</div>
                        <div v-if="item.ticket"><i class="fa-solid fa-ticket mr-1"></i> ¬•{{ item.ticket }}</div>
                    </div>
                    <p v-if="item.note" class="mt-2 text-[11px] text-gray-400 italic border-t pt-2">{{ item.note }}</p>
                    
                    <div class="absolute -left-2 top-1/2 -translate-y-1/2 flex flex-col space-y-2 opacity-0 group-hover:opacity-100 transition">
                        <button @click.stop="moveItem(idx, -1)" class="w-6 h-6 bg-white rounded-full shadow text-[10px]">‚Üë</button>
                        <button @click.stop="moveItem(idx, 1)" class="w-6 h-6 bg-white rounded-full shadow text-[10px]">‚Üì</button>
                    </div>
                </div>
            </div>
        </section>

        <section v-if="activeTab === 'shopping'" class="grid grid-cols-2 gap-4">
            <div v-for="(item, idx) in shoppingList" class="bg-white rounded-3xl overflow-hidden premium-shadow group">
                <div class="aspect-square bg-gray-100 relative">
                    <img v-if="item.img" :src="item.img" class="w-full h-full object-cover">
                    <div v-else class="w-full h-full flex items-center justify-center text-gray-300">
                        <i class="fa-regular fa-image text-2xl"></i>
                    </div>
                    <button @click="removeItem('shopping', idx)" class="absolute top-2 right-2 bg-black/10 text-white w-6 h-6 rounded-full text-[10px] backdrop-blur-md opacity-0 group-hover:opacity-100 transition">‚úï</button>
                </div>
                <div class="p-3">
                    <p class="text-xs font-medium truncate">{{ item.name }}</p>
                </div>
            </div>
        </section>

        <section v-if="activeTab === 'spending'" class="space-y-6">
            <div class="bg-white p-8 rounded-[2.5rem] premium-shadow text-center">
                <p class="text-[10px] tracking-widest text-gray-400 uppercase mb-1">Total Spending</p>
                <h2 class="text-4xl font-light">¬• {{ totalSpending.toLocaleString() }}</h2>
                <p class="text-xs text-gray-300 mt-2">‚âà HKD {{ (totalSpending * exchangeRate).toFixed(0) }}</p>
            </div>

            <div class="space-y-3">
                <div v-for="(ex, idx) in expenses" class="bg-white p-4 rounded-2xl flex justify-between items-center premium-shadow">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-sm">
                            {{ getCategoryIcon(ex.category) }}
                        </div>
                        <div>
                            <p class="text-xs font-medium">{{ ex.name }}</p>
                            <p class="text-[10px] text-gray-400">{{ ex.date }} ¬∑ {{ ex.payment }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-bold">¬•{{ ex.amount }}</p>
                        <button @click="removeItem('spending', idx)" class="text-[10px] text-gray-300">Delete</button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <button @click="openAddModal" class="fab">
        <i class="fa-solid fa-plus text-xl"></i>
    </button>

    <div v-if="showModal" class="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4 modal-overlay" @click.self="showModal = false">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-6 space-y-4 shadow-2xl animate-slide-up">
            <h3 class="text-lg font-bold mb-4">{{ modalTitle }}</h3>
            
            <div v-if="activeTab === 'schedule'" class="space-y-3">
                <select v-model="form.category">
                    <option value="ÁæéÈ£ü">üç± ÁæéÈ£ü</option>
                    <option value="ÊôØÈªû">üóª ÊôØÈªû</option>
                    <option value="‰ΩèÂÆø">üè® ‰ΩèÂÆø</option>
                    <option value="‰∫§ÈÄö">‚ö° ‰∫§ÈÄö</option>
                </select>
                <input v-model="form.name" placeholder="Ë°åÁ®ãÂêçÁ®±">
                <input v-model="form.hours" placeholder="ÁáüÊ•≠ÊôÇÈñì (Â¶Ç 09:00-18:00)">
                <input v-if="form.category === 'ÊôØÈªû'" v-model="form.ticket" type="number" placeholder="ÈñÄÁ•®ÈáëÈ°ç (JPY)">
                <textarea v-model="form.note" placeholder="ÁâπËâ≤ & ÂÇôË®ª" rows="2"></textarea>
                <div class="flex items-center space-x-2">
                    <label class="text-xs text-gray-400">ÂâçÈ†Ö‰∫§ÈÄöÔºö</label>
                    <select v-model="form.transport" class="flex-1">
                        <option value="walk">üö∂ Ê≠•Ë°å</option>
                        <option value="car">üöó ÈñãËªä</option>
                        <option value="transit">üöå Â§ßÁúæÈÅãËº∏</option>
                    </select>
                </div>
            </div>

            <div v-if="activeTab === 'shopping'" class="space-y-3 text-center">
                <input v-model="form.name" placeholder="Áâ©ÂìÅÂêçÁ®±">
                <div @click="triggerUpload" class="h-32 border-2 border-dashed border-gray-100 rounded-2xl flex flex-col items-center justify-center text-gray-400 cursor-pointer overflow-hidden">
                    <img v-if="form.img" :src="form.img" class="w-full h-full object-cover">
                    <span v-else><i class="fa-solid fa-camera mb-2"></i><br>‰∏äÂÇ≥ÁÖßÁâá</span>
                </div>
                <input type="file" id="fileInput" class="hidden" @change="handleUpload">
            </div>

            <div v-if="activeTab === 'spending'" class="space-y-3">
                <select v-model="form.category">
                    <option>‰∫§ÈÄö</option><option>È£≤È£ü</option><option>‰ΩèÂÆø</option><option>ÈñÄÁ•®</option><option>Ë≥ºÁâ©</option><option>ÂÖ∂‰ªñ</option>
                </select>
                <input v-model="form.name" placeholder="Ëä±Ë≤ªÂêçÁ®±">
                <input v-model="form.date" type="date">
                <input v-model.number="form.amount" type="number" placeholder="ÈáëÈ°ç (Êó•Âπ£)">
                <select v-model="form.payment">
                    <option>ÁèæÈáë</option><option>‰ø°Áî®Âç°</option>
                </select>
            </div>

            <div class="flex space-x-3 pt-4">
                <button v-if="isEditing" @click="confirmDelete" class="flex-1 py-3 rounded-xl bg-red-50 text-red-500 text-sm">Âà™Èô§</button>
                <button @click="saveData" class="flex-[2] py-3 rounded-xl bg-black text-white text-sm font-bold">ÂÑ≤Â≠ò</button>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed, onMounted } = Vue;

createApp({
    setup() {
        const activeTab = ref('schedule');
        const currentDayIndex = ref(0);
        const exchangeRate = ref(0.051); // ÂÅáË®≠ JPY to HKD ÂåØÁéá
        const calcJPY = ref(1000);
        const showModal = ref(false);
        const modalTitle = ref('');
        const isEditing = ref(false);
        const editIdx = ref(null);

        // ÂàùÂßãÂåñÊó•Êúü (Day 1 - Day 5)
        const days = ref([
            { dayNum: '1', week: 'Fri', date: '6/1' },
            { dayNum: '2', week: 'Sat', date: '6/2' },
            { dayNum: '3', week: 'Sun', date: '6/3' },
            { dayNum: '4', week: 'Mon', date: '6/4' },
            { dayNum: '5', week: 'Tue', date: '6/5' }
        ]);

        // Ë≥áÊñôÁµêÊßã
        const itinerary = ref({
            0: [{ id: 1, name: 'Êñ∞ÂçÉÊ≠≤Ê©üÂ†¥', category: '‰∫§ÈÄö', transport: 'car', travelTime: '0' }],
            1: [], 2: [], 3: [], 4: []
        });
        const shoppingList = ref([]);
        const expenses = ref([]);
        
        // ÈùúÊÖãË≥áË®ä
        const flights = ref([
            { type: 'ÂéªÁ®ã Departure', from: 'HKG', to: 'CTS', depTime: '09:15', arrTime: '15:10', duration: '4h 55m', no: 'CX580' },
            { type: 'ÂõûÁ®ã Return', from: 'CTS', to: 'HKG', depTime: '16:15', arrTime: '21:00', duration: '5h 45m', no: 'CX581' }
        ]);
        const hotels = ref([
            { name: 'Êú≠ÂπåÁ¥¢ÊãâÂà©‰∫ûË•øÈêµÈÖíÂ∫ó', tel: '+81 11-208-5555', address: 'Êú≠ÂπåÂ∏Ç‰∏≠Â§ÆÂçÄÂåó4Êù°Ë•ø6‰∏ÅÁõÆ1' }
        ]);

        const form = ref({});

        const currentDayItinerary = computed(() => itinerary.value[currentDayIndex.value] || []);
        const totalSpending = computed(() => expenses.value.reduce((sum, item) => sum + (item.amount || 0), 0));

        // ÈÇèËºØÊñπÊ≥ï
        const openMap = (loc) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc + ' ÂåóÊµ∑ÈÅì')}`, '_blank');
        
        const getTransportIcon = (t) => ({
            walk: 'fa-solid fa-person-walking',
            car: 'fa-solid fa-car',
            transit: 'fa-solid fa-train-subway'
        }[t] || 'fa-solid fa-ellipsis');

        const getCategoryIcon = (c) => ({
            '‰∫§ÈÄö': 'üöó', 'È£≤È£ü': 'üçú', '‰ΩèÂÆø': 'üè®', 'ÈñÄÁ•®': 'üé´', 'Ë≥ºÁâ©': 'üõçÔ∏è'
        }[c] || 'üí∞');

        const openAddModal = () => {
            isEditing.value = false;
            modalTitle.value = "Êñ∞Â¢ûÈ†ÖÁõÆ";
            form.value = (activeTab.value === 'spending') ? { date: new Date().toISOString().split('T')[0], category: 'È£≤È£ü', payment: 'ÁèæÈáë' } : { category: 'ÊôØÈªû', transport: 'walk' };
            showModal.value = true;
        };

        const editItem = (type, item, idx) => {
            isEditing.value = true;
            editIdx.value = idx;
            modalTitle.value = "Á∑®ËºØÈ†ÖÁõÆ";
            form.value = { ...item };
            showModal.value = true;
        };

        const saveData = () => {
            if (activeTab.value === 'schedule') {
                if (isEditing.value) itinerary.value[currentDayIndex.value][editIdx.value] = { ...form.value };
                else itinerary.value[currentDayIndex.value].push({ ...form.value, id: Date.now() });
            } else if (activeTab.value === 'shopping') {
                shoppingList.value.push({ ...form.value });
            } else if (activeTab.value === 'spending') {
                expenses.value.push({ ...form.value });
            }
            showModal.value = false;
        };

        const confirmDelete = () => {
            if (confirm("Á¢∫ÂÆöË¶ÅÂà™Èô§ÂóéÔºü")) {
                if (activeTab.value === 'schedule') itinerary.value[currentDayIndex.value].splice(editIdx.value, 1);
                showModal.value = false;
            }
        };

        const moveItem = (idx, direction) => {
            const list = itinerary.value[currentDayIndex.value];
            const newIdx = idx + direction;
            if (newIdx >= 0 && newIdx < list.length) {
                [list[idx], list[newIdx]] = [list[newIdx], list[idx]];
            }
        };

        const triggerUpload = () => document.getElementById('fileInput').click();
        const handleUpload = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => form.value.img = event.target.result;
            reader.readAsDataURL(file);
        };

        const removeItem = (type, idx) => {
            if (confirm("Âà™Èô§Ê≠§È†ÖÔºü")) {
                if (type === 'shopping') shoppingList.value.splice(idx, 1);
                if (type === 'spending') expenses.value.splice(idx, 1);
            }
        };

        return {
            activeTab, currentDayIndex, days, itinerary, shoppingList, expenses, flights, hotels,
            calcJPY, exchangeRate, totalSpending, currentDayItinerary, showModal, modalTitle, form, isEditing,
            openMap, getTransportIcon, getCategoryIcon, openAddModal, editItem, saveData, confirmDelete, moveItem,
            triggerUpload, handleUpload, removeItem
        };
    }
}).mount('#app');
</script>

<style>
@keyframes slide-up {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
}
.animate-slide-up { animation: slide-up 0.3s ease-out; }
</style>
</body>
</html>